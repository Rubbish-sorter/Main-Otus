# Лабораторная работа - Настройка NAT для IPv4

##Топология
 
## Таблица адресации
|Устройство	|Интерфейс	|IP-адрес	|Маска подсети|
|----|---|---|----|
|R1	|G0/0/0	|209.165.200.230	|255.255.255.248|
|R1|	G0/0/1|	192.168.1.1	|255.255.255.0|
|R2	|G0/0/0|	209.165.200.225|	255.255.255.248|
|R2	|Lo1	|209.165.200.1|	255.255.255.224|
|S1	|VLAN 1|	192.168.1.11|	255.255.255.0|
|S2	|VLAN 1	|192.168.1.12|	255.255.255.0|
|PC-A	|NIC	|192.168.1.2	|255.255.255.0|
|PC-B|	NIC	|192.168.1.3	|255.255.255.0|
## Цели
Часть 1. Создание сети и настройка основных параметров устройства  
Часть 2. Настройка и проверка NAT для IPv4  
Часть 3. Настройка и проверка PAT для IPv4  
Часть 4. Настройка и проверка статического NAT для IPv4.  
Общие сведения/сценарий
Преобразование (NAT) — это процесс, при котором сетевое устройство, например маршрутизатор Cisco, назначает публичный адрес узлам в пределах частной сети. NAT используют для сокращения количества публичных IP-адресов, используемых организацией, поскольку количество доступных публичных IPv4-адресов ограничено.   
Интернет-провайдер выделил компании общедоступное пространство IP-адресов 209.165.200.224/29. Эта сеть используется для обращения к каналу между маршрутизатором ISP (R2) и шлюзом компании (R1). Первый адрес (209.165.200.225) назначается интерфейсу g0/0 на R2, а последний адрес (209.165.200.230) назначается интерфейсу g0/0/0 на R1. Остальные адреса (209.165.200.226-209.165.200.229) будут использоваться для предоставления доступа в Интернет хостам компании. Маршрут по умолчанию используется от R1 до R2. Подключение интернет-провайдера к Интернету смоделировано loopback-адресом на маршрутизаторе интернет-провайдера.   
В этой лабораторной работе  вы будете настраивать различные типы NAT. Вы выполните тестирование, отображение и проверку осуществления всех преобразований и проанализируете статистику NAT/PAT для контроля процесса.   

Необходимые ресурсы  
-	2 маршрутизатора (Cisco 4221 с универсальным образом Cisco IOS XE версии 16.9.4 или аналогичным)    
-	2 коммутатора (Cisco 2960 с операционной системой Cisco IOS 15.2(2) (образ lanbasek9) или аналогичная модель)  
-	2 ПК (ОС Windows с программой эмуляции терминалов, такой как Tera Term)  
-	Консольные кабели для настройки устройств Cisco IOS через консольные порты.  
-	Кабели Ethernet, расположенные в соответствии с топологией    
Инструкции  
### Часть 1. Создание сети и настройка основных параметров устройства  
В первой части лабораторной работы вам предстоит создать топологию сети и настроить базовые параметры для узлов ПК и коммутаторов.  
#### Шаг 1. Подключите кабели сети согласно приведенной топологии.  
Подключите устройства в соответствии с топологией и подсоедините соответствующие кабели.  
#### Шаг 2. Произведите базовую настройку маршрутизаторов.  
Откройте окно конфигурации  
a.	Назначьте маршрутизатору имя устройства.  
b.	Отключите поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.  
c.	Назначьте class в качестве зашифрованного пароля привилегированного режима EXEC.  
d.	Назначьте cisco в качестве пароля консоли и включите вход в систему по паролю.  
e.	Назначьте cisco в качестве пароля VTY и включите вход в систему по паролю.  
f.	Зашифруйте открытые пароли.  
g.	Создайте баннер с предупреждением о запрете несанкционированного доступа к устройству.  
h.	Настройте IP-адресации интерфейса, как указано в таблице выше.  
i.	Настройте маршрут по умолчанию. от R2 до  R1.  
j.	Сохраните текущую конфигурацию в файл загрузочной конфигурации.  
Закройте окно настройки.   
**R1**
en   
conf t    
hostname R1  
no ip domain-lookup  
ser pass  
enable secret class  
banner motd #Unauthorized access is strictly prohibited!#  
line con 0    
logg sync  
password cisco  
login  
line vty 0 15  
password cisco  
login  
exit  
int g0/0/1  
ip addr 192.168.1.1 255.255.255.0  
no sh  
!
int g0/0/0  
ip addr 209.165.200.230 255.255.255.248  
no sh  
!
 exit  
do copy run start  

Отработало успешно

**R2**  
en   
conf t  
hostname R2 
no ip domain-lookup 
ser pass  
enable secret class  
banner motd #Unauthorized access is strictly prohibited!#  
line con 0  
logg sync   
password cisco   
login  
line vty 0 15  
password cisco  
login  
exit
ip route 0.0.0.0 0.0.0.0 209.165.200.230  
int lo 1  
ip addr 209.165.200.1 255.255.255.224  
no sh  
!  
int g0/0/0  
ip addr 209.165.200.225 255.255.255.248  
no sh  
!  
 exit  
do copy run start   

Отработало успешно  

#### Шаг 3. Настройте базовые параметры каждого коммутатора.    
Откройте окно конфигурации    
a.	Присвойте коммутатору имя устройства.     
b.	Отключите поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.    c.	Назначьте class в качестве зашифрованного пароля привилегированного режима EXEC.      
d.	Назначьте cisco в качестве пароля консоли и включите вход в систему по паролю.    
e.	Назначьте cisco в качестве пароля VTY и включите вход в систему по паролю.    
f.	Зашифруйте открытые пароли.    
g.	Создайте баннер с предупреждением о запрете несанкционированного доступа к устройству.    
h.	Выключите все интерфейсы, которые не будут использоваться.    
i.	Настройте IP-адресации интерфейса, как указано в таблице выше.    
j.	Сохраните текущую конфигурацию в файл загрузочной конфигурации.    
Закройте окно настройки.  

**S1**  
en   
conf t  
hostname S1  
no ip domain-lookup  
ser pass  
enable secret class  
banner motd #Unauthorized access is strictly prohibited!#  
line con 0  
logg sync  
password cisco  
login   
line vty 0 15   
password cisco  
login  
exit  
int vlan 1  
ip addr 192.168.1.11 255.255.255.0  
ip default 192.168.1.1  
no sh  
!  
int range  f0/2-4  
sh  
!  
int range f0/7-24  
sh  
!  
int range g0/1-2  
sh  
exit
do copy run start 

Отработало успешно.  

**S2**  
en     
conf t 
hostname S2  
no ip domain-lookup  
ser pass  
enable secret class  
banner motd #Unauthorized access is strictly prohibited!#  
line con 0  
logg sync  
password cisco  
login  
line vty 0 15  
password cisco  
login  
exit  
int vlan 1  
ip addr 192.168.1.12 255.255.255.0  
ip default 192.168.1.1  
no sh 
!  
int range  f0/2-17  
sh  
!  
int range f0/19-24  
sh  
!  
int range g0/1-2  
sh  
exit  
do copy run start   
Отработало успешно.

Часть 2. Настройка и проверка NAT для IPv4.  
В части 2 необходимо настроить и проверить NAT для IPv4. 
Шаг 1. Настройте NAT на R1, используя пул из трех адресов 209.165.200.226-209.165.200.228.   
Откройте окно конфигурации  
a.	Настройте простой список доступа, который определяет, какие хосты будут разрешены для трансляции. В этом случае все устройства в локальной сети R1 имеют право на трансляцию.  
R1(config)# access-list 1 permit 192.168.1.0 0.0.0.255   
b.	Создайте пул NAT и укажите ему имя и диапазон используемых адресов.  
R1(config)# ip nat pool PUBLIC_ACCESS 209.165.200.226 209.165.200.228 netmask 255.255.255.248   
Примечание. Параметр маски сети не является разделителем IP-адресов. Это должна быть правильная маска подсети для назначенных адресов, даже если вы используете не все адреса подсети в пуле.   
c.	Настройте перевод, связывая ACL и пул с процессом преобразования.  
R1(config)# ip nat inside source list 1 pool PUBLIC_ACCESS   
Примечание: Три очень важных момента. Во-первых, слово «inside» имеет решающее значение для работы такого рода NAT. Если вы опустить его, NAT не будет работать. Во-вторых, номер списка — это номер ACL, настроенный на предыдущем шаге. В-третьих, имя пула чувствительно к регистру.   
d.	Задайте внутренний (inside) интерфейс.     
e.	Определите внешний (outside) интерфейс.  
Шаг 2. Проверьте и проверьте конфигурацию.   
a.	С PC-B,  запустите эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните процес поиска и устранения неполадок. На R1 отобразите таблицу NAT на R1 с помощью команды show ip nat translations.  

Вопросы:  
Во что был транслирован внутренний локальный адрес PC-B?  
 
Какой тип адреса NAT является переведенным адресом?   
 
b.	С PC-A, запустите  эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды show ip nat translations.
R
c.	Обратите внимание, что предыдущая трансляция для PC-B все еще находится в таблице. Из S1, эхо-запрос интерфейса Lo1 (209.165.200.1) на R2. Если эхо-запрос не прошел, выполните отладку. На R1 отобразите таблицу NAT на R1 с помощью команды show ip nat translations.
d.	Теперь запускаем пинг R2 Lo1 из S2. На этот раз перевод завершается неудачей, и вы получаете эти сообщения (или аналогичные) на консоли R1:

e.	Это ожидаемый результат, потому что выделено только 3 адреса, и мы попытались ping Lo1 с четырех устройств. Напомним, что NAT — это трансляция «один-в-один». Как много выделено трансляций? Введите команду show ip nat translations verbose , и вы увидите, что ответ будет 24 часа.   
R1# show ip nat translations verbose 
не сработало в CPT  
f.	Учитывая, что пул ограничен тремя адресами, NAT для пула адресов недостаточно для нашего приложения. Очистите преобразование NAT и статистику, и мы перейдем к PAT.  
Команд очистки статистики  трансляций тоже нет в CPT.  




